### Assumes current directory is: core/smartbody/sbm/bin
### Simple Gaze Test Seq Script

# ---- Loading data/sbm-common assets
0	path seq ../../../../data/sbm-common/scripts
0	path ME ../../../../data/sbm-common/common-sk
0	echo >>> Loading common motions and poses...
0	load motions -R ../../../../data/sbm-common/common-sk
0	load poses   -R ../../../../data/sbm-common/common-sk

# ---- Using virtual timing
0	time sleepfps 0
0	time simfps 60
0	time reset

# ---- Setting characters and default posture
#  Common-sk assets are centered on the pelvis,
#  placed 102 units above the ground plane.
#  Using Unia (Unreal-based) class names for renderer assets
#  Using remote rVoice speech synthesis
#  NOTE: increment time to insure common-init is processed in order.
1	char doctor init common.sk SasoBase.SasoDoctorPerez
1	set character doctor world_offset x 35 y 102 h -17
1	set character doctor voice remote M021

#  Using "test bml" command to avoid hard-coding
#  message id into sequence file.
1  test bml character doctor noecho posture HandsAtSide_Motex

# Setting up example motions
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachRtHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachRtMidHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachRtMidLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachLfLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachLfHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachLfMidHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachLfMidLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachRtLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachMiddleHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachMiddleMidHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachMiddleMidLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachMiddleLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_Lf
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_Rt
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_MiddleHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_MiddleLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_MiddleMidHigh
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachClose_MiddleMidLow
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_High1
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_High2
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_Low1
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_Low2
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_MidLow1
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_MidLow2
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_MidHigh1
1 char doctor reachmotion add ChrHarmony_Relax001_ArmReachBehind_MidHigh2

# Setting up hand grabbing motions
1 char doctor handmotion grabhand ChrHarmony_Relax001_HandGraspSmSphere_Grasp
1 char doctor handmotion reachhand ChrHarmony_Relax001_HandGraspSmSphere_Reach
1 char doctor handmotion releasehand ChrHarmony_Relax001_HandGraspSmSphere_Release

# ---- Setting Camera Parameters
# * Assumes doctor scaled character standing near the origin, as is about 200 units tall
1	viewer open   600 600  400 50
1	camera eye    0 70 240
1	camera center 40 70 0
1	pawn camera init loc 0 166 185
1	set pawn camera world_offset x 0 y 166 z 185
1	set test character doctor

# Setting up skinned mesh
2 char doctor smoothbindweight ../../../../data/mesh/doctor/Doctor.xml
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/faceShape.obj
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/left_handShape.obj
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/pantsShape.obj
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/polySurfaceShape10.obj
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/right_handShape.obj
2 char doctor smoothbindmesh ../../../../data/mesh/doctor/shirtShape.obj
2 char doctor viewer 4

# ---- Testing reach
2 pawn foo init geom box size 4
2 set pawn foo world_offset x 20 y 150 z 40
2 pawn foo2 init geom box size 4
2 set pawn foo2 world_offset x 0 y 120 z 45
2 pawn foo3 init geom box size 4
2 set pawn foo3 world_offset x 40 y 100 z 40.5
2 pawn foo4 init geom box size 4
2 set pawn foo4 world_offset x 0 y 120 z -22
2 bml char doctor <sbm:reach sbm:handle="rdoctor" effector="r_middle1"/>
2 registerevent reach "$1"
2.5 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:foot-ik="true"/>
2.5 char doctor reachmotion build

4 physics enable
4 physics gravity 980
4.5 snapshot
5 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="pick-up" target="foo" sbm:fade-in="1.0"/>
8 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="pick-up" sbm:reach-finish="true"/>
10 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="put-down" sbm:target-pos="40 140 40"/>
12 snapshot
13 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="put-down" sbm:reach-finish="true"/>

16 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="pick-up" target="foo2" sbm:fade-in="1.0"/>
19 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="pick-up" sbm:reach-finish="true"/>
21 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="put-down" sbm:target-pos="0 140 -20"/>
23 snapshot
24 bml char doctor <sbm:reach sbm:handle="rdoctor" sbm:action="put-down" sbm:reach-finish="true"/>
25 quit

