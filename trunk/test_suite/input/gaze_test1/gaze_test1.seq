### Assumes current directory is: core/smartbody/sbm/bin
### Simple Gaze Test Seq Script

# ---- Loading data/sbm-common assets
0	path seq ../../../../data/sbm-common/scripts
0	path ME ../../../../data/sbm-common/common-sk
0	echo >>> Loading common motions and poses...
0	load motions -R ../../../../data/sbm-common/common-sk
0	load poses   -R ../../../../data/sbm-common/common-sk

# ---- Using virtual timing
0	time sleepfps 0
0	time simfps 60
0	time reset

# ---- Setting characters and default posture
#  Common-sk assets are centered on the pelvis,
#  placed 102 units above the ground plane.
#  Using Unia (Unreal-based) class names for renderer assets
#  Using remote rVoice speech synthesis
#  NOTE: increment time to insure common-init is processed in order.
1	char doctor init common.sk SasoBase.SasoDoctorPerez
1	set character doctor world_offset x 35 y 102 h -17
1	set character doctor voice remote M021

#  Using "test bml" command to avoid hard-coding
#  message id into sequence file.
1	test bml character doctor noecho posture LHandOnHip_Motex

# ---- Setting Camera Parameters
# * Assumes doctor scaled character standing near the origin, as is about 200 units tall
1	viewer open   600 600  400 50
1	camera eye    40 150 90
1	camera center 40 150 0
#  Reference location for gazing
#  * This pawn does not follow the viewer camera
#  * Bug in pawn location/rotation initialization,
#    so set it once after initialization
1	pawn camera init loc 0 166 185
1	set pawn camera world_offset x 0 y 166 z 185

1	set test character doctor

# ---- Testing gaze
2	begin
	test bml
	<gaze target="camera">
		<sbm:chest/><!-- default zeroes -->
		<sbm:neck pitch="-60" /><!-- upward to jut back -->
		<sbm:head/><!-- default zeroes, trying to realign -->
			
		<!-- the above is the same as...
		<sbm:neck pitch="-60" interpolate-bias="false" />
		-->
	</gaze>
	end

3	snapshot

4	begin
	test bml
	<gaze target="camera">
		<sbm:chest/><!-- default zeroes -->
		<sbm:neck pitch="60" /><!-- downward to jut forward -->
		<sbm:head/><!-- default zeroes, trying to realign -->
			
		<!-- the above is the same as...
		<sbm:neck pitch="60" interpolate-bias="false" />
		-->
	</gaze>
	end

5	snapshot

6	begin
	test bml
	<gaze target="camera">
		<sbm:chest pitch="-40"/><!-- lean back -->
		<sbm:head  heading="10" pitch="-10"/>
	</gaze>
	end

8	camera eye 40 150 90
8	camera center 40 150 0
8	begin
	test bml
	<gaze target="camera">
		<!-- lean forward -->
		<sbm:lumbar pitch="80"/>
		<sbm:chest pitch="80"/>
		<!-- but tilt head back for interest -->
		<sbm:head  pitch="-20"/>
	</gaze>
	end

9	snapshot

10	begin
	test bml
	<gaze target="camera">
		<sbm:chest /><!-- zero bias -->
		<sbm:head  heading="20" pitch="10"/><!-- left, down -->
	</gaze>
	end

11	snapshot

12	begin
	test bml
	<gaze target="camera">
		<sbm:chest /><!-- zero bias -->
		<sbm:head  heading="25" pitch="-15"/><!-- left, down -->
	</gaze>
	end

13	snapshot

14	quit
